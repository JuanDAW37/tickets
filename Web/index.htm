<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Tickets de TPV y caja</title>
        <style>
        article {
            border: 1px solid #ccc;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        img {
            height: auto;
            width: 320px;
            max-width: 100%;
        }
    </style>
        <script type="module">
            const crear = document.getElementById('crear'),
                borrar = document.getElementById('baja'),
                imprimir = document.getElementById('imprimir')

            crear.onclick = () => {    
                let num = document.getElementById('numero');    
                const data = {
                    numero:document.getElementById('numero').value,
                    fecha:document.getElementById('fecha').value,
                    descripcion:document.getElementById('descripcion').value,
                    base:document.getElementById('base').value,
                    iva:document.getElementById('iva').value,
                    cuota:document.getElementById('cuota').value,
                    total:document.getElementById('total').value        
                }
                fetch(`http://localhost:1234/tickets`, data, { method: 'POST'})
                .then(res =>{
                    console.log(res)
                });                
                    let dataArray = JSON.parse(data);            
                    let datos=[];
                    dataArray.forEach(e => {
                        datos.push(e);    
                    });
                    const newTicket = {
                        id: randomUUID(), 
                        ...data
                    }        
                    datos.push(newTicket)                       
                    fs.writeFile(file, JSON.stringify(datos, null, 2), (error)=>{
                        if(error){
                            console.log(error);
                            throw error;                
                        }else{
                            console.log(`Datos grabados... ${newTicket.descripcion}`);                
                        }           
                    });            
        }

            //Para imprimir
            imprimir.onclick = () => {    
                fetch("http://localhost:1234/tickets")
                    .then(res => res.json())
                    .then(tickets => {
                        const html = tickets.map(ticket => {
                            return `
                                <article data-id="${ticket.id}">                        
                                    <h2>Ticket nº: ${ticket.numero}</h2>
                                    <p>Fecha: ${ticket.fecha}</p>                        
                                    <p>Descripcion: ${ticket.descripcion}</p> 
                                    <p>Base: ${ticket.base}</p> 
                                    <p>Iva: ${ticket.iva}</p> 
                                    <p>Cuota: ${ticket.cuota}</p> 
                                    <p>Total: ${ticket.total}</p>                                 
                                </article>`
                        }).join('')                
                        //document.querySelector('main').innerHTML=html
                    })
            }

            borrar.onclick = () => {
                fetch(`http://localhost:1234/tickets/${id}`, {
                    method: 'DELETE'
                })                    
                    .then(response => {
                        if(response.ok){
                            article.remove()
                    }                        
                    })
            }   
    </script>
    </head>
    <body>
        <main>
            <h2>Restaurante Brisas</h2>
            <h3>Tickets de TPV y caja</h3>
            <form>                
                <label for="numero">Número</label>
                <input type="number" name="numero" id="numero" value="" /><br>
                <label for="fecha">Fecha</label>
                <input type="text" name="fecha" id="fecha" value="" /><br>
                <label for="descripcion">Descripcion</label>
                <input type="text" name="descripcion" id="descripcion" value="" /><br>
                <label for="base">Base</label>
                <input type="number" name="base" id="base" value="0.00" /><br>
                <label for="iva">Iva</label>
                <input type="number" name="iva" id="iva" value="0.00" /><br>
                <label for="cuota">Cuota</label>
                <input type="number" name="cuota" id="cuota" value="0.00" /><br>
                <label for="total">Total</label>
                <input type="number" name="total" id="total" value="0.00" /><br>
                <button type="button" id="crear">Nuevo</button>
                <button type="button" id="borrar">Borrar</button>
                <button type="button" id="imprimir">Imprimir</button>
            </form>
        </main>
    </body>
</html>